"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3995],{5010:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-39e0a9d6",path:"/guide/services/crud.html",title:"CRUD",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:3,title:"Search vs Filter",slug:"search-vs-filter",children:[]},{level:3,title:"defining columns",slug:"defining-columns",children:[]},{level:3,title:"Use Select fields with dependency",slug:"use-select-fields-with-dependency",children:[]},{level:3,title:"Use CRUD with our export service",slug:"use-crud-with-our-export-service",children:[]}],filePathRelative:"guide/services/crud.md",git:{updatedTime:1696505147e3,contributors:[{name:"Iman Daneshi",email:"emandaneshikohan@gmail.com",commits:2},{name:"Anton",email:"a.shumansky@gmail.com",commits:1},{name:"h-khodadadeh",email:"khodadadeh@coretrix.com",commits:1}]}}},9436:(n,s,a)=>{a.r(s),a.d(s,{default:()=>e});const t=(0,a(6252).uE)('<h1 id="crud" tabindex="-1"><a class="header-anchor" href="#crud" aria-hidden="true">#</a> CRUD</h1><p>This service it gives you ability to build gql query and apply different query parameters to the query that should be used in listing pages</p><p>Register the service into your <code>main.go</code> file:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>registry<span class="token punctuation">.</span><span class="token function">ServiceProviderCrud</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Access the service:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>service<span class="token punctuation">.</span><span class="token function">DI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Crud</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="search-vs-filter" tabindex="-1"><a class="header-anchor" href="#search-vs-filter" aria-hidden="true">#</a> Search vs Filter</h3><p>Search is used on strings while filtering can be used on wide range of data types. One important note to remember is that if your column is searchable it can&#39;t be filterable.</p><h3 id="defining-columns" tabindex="-1"><a class="header-anchor" href="#defining-columns" aria-hidden="true">#</a> defining columns</h3><p>First you need to define what columns you&#39;re going to have and which of them will be Searchable, Sortable or Filterable(user for enum values). Using this configuration you also define the supported filters that can be applied.</p><p>The second step is in your controller(handler) to call few methods from that service that will build the right query for you based on the request. Crud service supports mysql query builder and redis-search query builder.</p><p>Example of the way you can use it:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//defining columns.</span>\n<span class="token keyword">func</span> <span class="token function">columns</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>crud<span class="token punctuation">.</span>Column <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>crud<span class="token punctuation">.</span>Column<span class="token punctuation">{</span>\n            <span class="token punctuation">{</span>\n                Key<span class="token punctuation">:</span>            <span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span>\n                Type<span class="token punctuation">:</span>           crud<span class="token punctuation">.</span>NumberType<span class="token punctuation">,</span>\n                Label<span class="token punctuation">:</span>          <span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span>\n                Searchable<span class="token punctuation">:</span>     <span class="token boolean">false</span><span class="token punctuation">,</span>\n                Sortable<span class="token punctuation">:</span>       <span class="token boolean">true</span><span class="token punctuation">,</span>\n                Visible<span class="token punctuation">:</span>        <span class="token boolean">true</span><span class="token punctuation">,</span>\n                Filterable<span class="token punctuation">:</span>     <span class="token boolean">true</span><span class="token punctuation">,</span>\n                FilterValidMap<span class="token punctuation">:</span> <span class="token boolean">nil</span><span class="token punctuation">,</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token punctuation">{</span>\n                Key<span class="token punctuation">:</span>            <span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span>\n                Type<span class="token punctuation">:</span>           crud<span class="token punctuation">.</span>StringType<span class="token punctuation">,</span>\n                Label<span class="token punctuation">:</span>          <span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span>\n                Searchable<span class="token punctuation">:</span>     <span class="token boolean">true</span><span class="token punctuation">,</span>\n                Sortable<span class="token punctuation">:</span>       <span class="token boolean">false</span><span class="token punctuation">,</span>\n                Visible<span class="token punctuation">:</span>        <span class="token boolean">true</span><span class="token punctuation">,</span>\n                Filterable<span class="token punctuation">:</span>     <span class="token boolean">false</span><span class="token punctuation">,</span>\n                FilterValidMap<span class="token punctuation">:</span> <span class="token boolean">nil</span><span class="token punctuation">,</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//listing request using by gql</span>\n<span class="token keyword">type</span> ListRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>\n    Page     <span class="token operator">*</span><span class="token builtin">int</span>                   <span class="token string">`json:&quot;Page&quot;`</span>\n    PageSize <span class="token operator">*</span><span class="token builtin">int</span>                   <span class="token string">`json:&quot;PageSize&quot;`</span>\n    Filter   <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token string">`json:&quot;Filter&quot;`</span>\n    Search   <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token string">`json:&quot;Search&quot;`</span>\n    SearchOr <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token string">`json:&quot;SearchOR&quot;`</span>\n    Sort     <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token string">`json:&quot;Sort&quot;`</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>and at the end your method where you return the response:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>cols <span class="token operator">:=</span> <span class="token function">columns</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\ncrudService <span class="token operator">:=</span> service<span class="token punctuation">.</span><span class="token function">DI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CrudService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\nsearchParams <span class="token operator">:=</span> crudService<span class="token punctuation">.</span><span class="token function">ExtractListParams</span><span class="token punctuation">(</span>cols<span class="token punctuation">,</span> crud<span class="token punctuation">.</span><span class="token function">ListRequestConvertorFromGQL</span><span class="token punctuation">(</span>userListRequest<span class="token punctuation">)</span><span class="token punctuation">)</span>\nquery <span class="token operator">:=</span> crudService<span class="token punctuation">.</span><span class="token function">GenerateListRedisSearchQuery</span><span class="token punctuation">(</span>searchParams<span class="token punctuation">)</span>\n\normService <span class="token operator">:=</span> ioc<span class="token punctuation">.</span><span class="token function">GetOrmEngineFromContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>\n<span class="token keyword">var</span> userEntities <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>UserEntity\n\normService<span class="token punctuation">.</span><span class="token function">RedisSearch</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>userEntities<span class="token punctuation">,</span> query<span class="token punctuation">,</span> beeorm<span class="token punctuation">.</span><span class="token function">NewPager</span><span class="token punctuation">(</span>searchParams<span class="token punctuation">.</span>Page<span class="token punctuation">,</span> searchParams<span class="token punctuation">.</span>PageSize<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\nuserEntityList <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>model<span class="token punctuation">.</span>User<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>userEntities<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token keyword">for</span> i<span class="token punctuation">,</span> userEntity <span class="token operator">:=</span> <span class="token keyword">range</span> userEntities <span class="token punctuation">{</span>\n    userEntityList<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> populate<span class="token punctuation">.</span><span class="token function">UserAdmin</span><span class="token punctuation">(</span>userEntity<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">return</span> <span class="token operator">&amp;</span>model<span class="token punctuation">.</span>UserList<span class="token punctuation">{</span>\n    Rows<span class="token punctuation">:</span>    userEntityList<span class="token punctuation">,</span>\n    Total<span class="token punctuation">:</span>   <span class="token function">len</span><span class="token punctuation">(</span>userEntityList<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Columns<span class="token punctuation">:</span> crud<span class="token punctuation">.</span><span class="token function">ColumnConvertorToGQL</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="use-select-fields-with-dependency" tabindex="-1"><a class="header-anchor" href="#use-select-fields-with-dependency" aria-hidden="true">#</a> Use Select fields with dependency</h3><p>Imagine you have these fields with such options, on is the country and for the city filter to work user must select the country first and then select the proper city that exists in the list of that country otherwise this filter will be ignored.</p><p>Take london as an example, if we select <code>United States</code> as country and <code>London</code> as city, then city filter will be ignored, so make sure this is also handled in your front-end.</p><p><strong>Note: If you don&#39;t set <code>FilterDependencyField</code> or <code>DataMapStringStringKeyStringValue</code> this filter will be ignored!</strong></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">columns</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>crud<span class="token punctuation">.</span>Column <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>crud<span class="token punctuation">.</span>Column<span class="token punctuation">{</span>\n    \t\t<span class="token punctuation">{</span>\n\t\t\tKey<span class="token punctuation">:</span>                    <span class="token string">&quot;Country&quot;</span><span class="token punctuation">,</span>\n\t\t\tFilterType<span class="token punctuation">:</span>             hitrixCrud<span class="token punctuation">.</span>SelectTypeStringString<span class="token punctuation">,</span>\n\t\t\tLabel<span class="token punctuation">:</span>                  <span class="token string">&quot;Country&quot;</span><span class="token punctuation">,</span>\n\t\t\tSearchable<span class="token punctuation">:</span>             <span class="token boolean">true</span><span class="token punctuation">,</span>\n\t\t\tSortable<span class="token punctuation">:</span>               <span class="token boolean">false</span><span class="token punctuation">,</span>\n\t\t\tVisible<span class="token punctuation">:</span>                <span class="token boolean">true</span><span class="token punctuation">,</span>\n\t\t\tTranslationDataEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n\t\t\tDataStringKeyStringValue<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>hitrixCrud<span class="token punctuation">.</span>StringKeyStringValue<span class="token punctuation">{</span>\n\t\t\t\t<span class="token punctuation">{</span>Key<span class="token punctuation">:</span> <span class="token string">&quot;bg&quot;</span><span class="token punctuation">,</span> Label<span class="token punctuation">:</span> <span class="token string">&quot;Bulgaria&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t\t<span class="token punctuation">{</span>Key<span class="token punctuation">:</span> <span class="token string">&quot;us&quot;</span><span class="token punctuation">,</span> Label<span class="token punctuation">:</span> <span class="token string">&quot;United States&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t\t<span class="token punctuation">{</span>Key<span class="token punctuation">:</span> <span class="token string">&quot;uk&quot;</span><span class="token punctuation">,</span> Label<span class="token punctuation">:</span> <span class="token string">&quot;United Kingdom&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t<span class="token punctuation">{</span>\n\t\t\tKey<span class="token punctuation">:</span>                   <span class="token string">&quot;City&quot;</span><span class="token punctuation">,</span>\n\t\t\tFilterType<span class="token punctuation">:</span>            hitrixCrud<span class="token punctuation">.</span>SelectTypeStringString<span class="token punctuation">,</span>\n\t\t\tLabel<span class="token punctuation">:</span>                 <span class="token string">&quot;City&quot;</span><span class="token punctuation">,</span>\n\t\t\tSearchable<span class="token punctuation">:</span>            <span class="token boolean">true</span><span class="token punctuation">,</span>\n\t\t\tSortable<span class="token punctuation">:</span>              <span class="token boolean">false</span><span class="token punctuation">,</span>\n\t\t\tVisible<span class="token punctuation">:</span>               <span class="token boolean">true</span><span class="token punctuation">,</span>\n\t\t\tFilterDependencyField<span class="token punctuation">:</span> <span class="token string">&quot;Country&quot;</span><span class="token punctuation">,</span>\n\t\t\tDataMapStringStringKeyStringValue<span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>hitrixCrud<span class="token punctuation">.</span>StringKeyStringValue<span class="token punctuation">{</span>\n\t\t\t\t<span class="token string">&quot;bg&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n\t\t\t\t\t<span class="token punctuation">{</span>Key<span class="token punctuation">:</span> <span class="token string">&quot;sofia&quot;</span><span class="token punctuation">,</span> Label<span class="token punctuation">:</span> <span class="token string">&quot;Sofia&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t\t\t<span class="token punctuation">{</span>Key<span class="token punctuation">:</span> <span class="token string">&quot;plovdiv&quot;</span><span class="token punctuation">,</span> Label<span class="token punctuation">:</span> <span class="token string">&quot;Plovdiv&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t\t<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t\t<span class="token string">&quot;us&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n\t\t\t\t\t<span class="token punctuation">{</span>Key<span class="token punctuation">:</span> <span class="token string">&quot;new_york&quot;</span><span class="token punctuation">,</span> Label<span class="token punctuation">:</span> <span class="token string">&quot;New York&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t\t\t<span class="token punctuation">{</span>Key<span class="token punctuation">:</span> <span class="token string">&quot;los_angeles&quot;</span><span class="token punctuation">,</span> Label<span class="token punctuation">:</span> <span class="token string">&quot;Los Angeles&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t\t<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t\t<span class="token string">&quot;uk&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n\t\t\t\t\t<span class="token punctuation">{</span>Key<span class="token punctuation">:</span> <span class="token string">&quot;london&quot;</span><span class="token punctuation">,</span> Label<span class="token punctuation">:</span> <span class="token string">&quot;London&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t\t<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t<span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="use-crud-with-our-export-service" tabindex="-1"><a class="header-anchor" href="#use-crud-with-our-export-service" aria-hidden="true">#</a> Use CRUD with our export service</h3><p>You can mix our crud service with our exporter service to add a quick and painless exporting system to your project</p><p>In order to do that you can follow these steps</p><p><strong>1 - Making your currently list view function private and creating another function for passing to gin router</strong></p><p>for example here we renamed &quot;List&quot; to &quot;list&quot; and we created a new &quot;ListRequest&quot; function and we&#39;re passing it to gin router instead of &quot;List&quot;</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>\n<span class="token keyword">func</span> <span class="token function">Columns</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>hitrixCrud<span class="token punctuation">.</span>Column <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>hitrixCrud<span class="token punctuation">.</span>Column<span class="token punctuation">{</span>\n        <span class="token punctuation">{</span>\n            Key<span class="token punctuation">:</span>        <span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span>\n            Label<span class="token punctuation">:</span>      <span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span>\n            Searchable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            Sortable<span class="token punctuation">:</span>   <span class="token boolean">true</span><span class="token punctuation">,</span>\n            Visible<span class="token punctuation">:</span>    <span class="token boolean">true</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">{</span>\n            Key<span class="token punctuation">:</span>        <span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span>\n            FilterType<span class="token punctuation">:</span> hitrixCrud<span class="token punctuation">.</span>InputTypeString<span class="token punctuation">,</span>\n            Label<span class="token punctuation">:</span>      <span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span>\n            Searchable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            Sortable<span class="token punctuation">:</span>   <span class="token boolean">false</span><span class="token punctuation">,</span>\n            Visible<span class="token punctuation">:</span>    <span class="token boolean">true</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> ListRow <span class="token keyword">struct</span> <span class="token punctuation">{</span>\n    ID        <span class="token builtin">uint64</span>\n    Name      <span class="token builtin">string</span>\n<span class="token punctuation">}</span>\n\n\n<span class="token keyword">func</span> <span class="token function">ListRequest</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token operator">*</span>hitrixCrud<span class="token punctuation">.</span>ListRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>city<span class="token punctuation">.</span>ResponseDTOList<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t<span class="token comment">// You should pass this function to the gin router</span>\n\t<span class="token keyword">return</span> <span class="token function">list</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span><span class="token function">DI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">OrmEngineForContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">func</span> <span class="token function">list</span><span class="token punctuation">(</span>ormService <span class="token operator">*</span>beeorm<span class="token punctuation">.</span>Engine<span class="token punctuation">,</span> request <span class="token operator">*</span>hitrixCrud<span class="token punctuation">.</span>ListRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>city<span class="token punctuation">.</span>ResponseDTOList<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t\n\t<span class="token comment">// this is the function that handles the getting and making the payload fot the crud that is going to be used</span>\n\t<span class="token comment">// for both list (endpoint) and exporting</span>\n\t\n\tcols <span class="token operator">:=</span> <span class="token function">Columns</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\tcrudService <span class="token operator">:=</span> service<span class="token punctuation">.</span><span class="token function">DI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Crud</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n\tsearchParams <span class="token operator">:=</span> crudService<span class="token punctuation">.</span><span class="token function">ExtractListParams</span><span class="token punctuation">(</span>cols<span class="token punctuation">,</span> request<span class="token punctuation">)</span>\n\tquery <span class="token operator">:=</span> crudService<span class="token punctuation">.</span><span class="token function">GenerateListRedisSearchQuery</span><span class="token punctuation">(</span>searchParams<span class="token punctuation">)</span>\n\n\t<span class="token keyword">var</span> cityEntities <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>CityEntity\n\t\n\t<span class="token comment">// your logic for getting entities from database with the query generated from crud</span>\n\n\trows <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>ListRow<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>cityEntities<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\t<span class="token comment">// you logic for creating rows for your crud</span>\n\n\t<span class="token keyword">return</span> <span class="token operator">&amp;</span>ResponseDTOList<span class="token punctuation">{</span>\n\t\tRows<span class="token punctuation">:</span>        rows<span class="token punctuation">,</span>\n\t\tTotal<span class="token punctuation">:</span>       <span class="token function">int</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">,</span>\n\t\tColumns<span class="token punctuation">:</span>     cols<span class="token punctuation">,</span>\n\t\tPageContext<span class="token punctuation">:</span> <span class="token function">getPageContext</span><span class="token punctuation">(</span>ormService<span class="token punctuation">)</span><span class="token punctuation">,</span>\n\t<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p><strong>2 - Creating a new handler for exporting the data obtained from &quot;list&quot; function</strong></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">ListExport</span><span class="token punctuation">(</span>ormService <span class="token operator">*</span>beeorm<span class="token punctuation">.</span>Engine<span class="token punctuation">,</span> request <span class="token operator">*</span>hitrixCrud<span class="token punctuation">.</span>ListRequest<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token builtin">uint64</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">error</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t\n\t<span class="token comment">// This function handles the data for exporting</span>\n\t\n\texportColumns <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// excel or csv Columns for passing to our exporter service</span>\n\tallExportData <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// data for passing to our exporter service</span>\n\n\tpager <span class="token operator">:=</span> beeorm<span class="token punctuation">.</span><span class="token function">NewPager</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>\n\n\t<span class="token keyword">for</span> <span class="token punctuation">{</span>\n\t\t\n\t\t<span class="token comment">// loop for getting all the data out of the list function, bypassing the pagination</span>\n\t\t\n\t\trequest<span class="token punctuation">.</span>Page <span class="token operator">=</span> <span class="token operator">&amp;</span>pager<span class="token punctuation">.</span>CurrentPage\n\t\trequest<span class="token punctuation">.</span>PageSize <span class="token operator">=</span> <span class="token operator">&amp;</span>pager<span class="token punctuation">.</span>PageSize\n\n\t\tres<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">list</span><span class="token punctuation">(</span>ormService<span class="token punctuation">,</span> request<span class="token punctuation">)</span>\n\n\t\t<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>\n\t\t\t<span class="token keyword">return</span> err<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>\n\t\t<span class="token punctuation">}</span>\n\t\t\n\t\t<span class="token comment">// GetExporterDataCrud converts any given rows which in example is []city.ListRow to</span>\n\t\t<span class="token comment">// exporter service columns and data as types of []string, [][]interface, exactly the data you need for passing to our</span>\n\t\t<span class="token comment">// exporting system</span>\n\t\t\n\t\tcolumns<span class="token punctuation">,</span> exportData <span class="token operator">:=</span> hitrixCrud<span class="token punctuation">.</span><span class="token function">GetExporterDataCrud</span><span class="token punctuation">(</span><span class="token function">Columns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>Rows<span class="token punctuation">)</span>\n\n\t\t<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> exportDataRow <span class="token operator">:=</span> <span class="token keyword">range</span> exportData <span class="token punctuation">{</span>\n\t\t\tallExportData <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>allExportData<span class="token punctuation">,</span> exportDataRow<span class="token punctuation">)</span>\n\t\t<span class="token punctuation">}</span>\n\n\t\texportColumns <span class="token operator">=</span> columns\n\n\t\t<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>Rows<span class="token punctuation">)</span> <span class="token operator">&lt;</span> pager<span class="token punctuation">.</span>PageSize <span class="token punctuation">{</span>\n\t\t\t<span class="token keyword">break</span>\n\t\t<span class="token punctuation">}</span>\n\n\t\tpager<span class="token punctuation">.</span><span class="token function">IncrementPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\t<span class="token punctuation">}</span>\n\n\t<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> exportColumns<span class="token punctuation">,</span> allExportData\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p><strong>3 - Creating the config and passing it to the service</strong></p><p>we pass the <code>ListExport</code> function that we created above to the config</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>\n    CityExportID                <span class="token operator">=</span> <span class="token string">&quot;cities&quot;</span>\n<span class="token punctuation">)</span>\n\n<span class="token keyword">var</span> RegisteredExportConfigs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>crud<span class="token punctuation">.</span>ExportConfig<span class="token punctuation">{</span>\n\t<span class="token punctuation">{</span>\n\t\tHandler<span class="token punctuation">:</span>          cityView<span class="token punctuation">.</span>ListExport<span class="token punctuation">,</span>\n\t\tID<span class="token punctuation">:</span>               CityExportID<span class="token punctuation">,</span>\n\t\tAllowedExtraArgs<span class="token punctuation">:</span> <span class="token boolean">nil</span><span class="token punctuation">,</span>\n\t\tResource<span class="token punctuation">:</span>         <span class="token string">&quot;city&quot;</span><span class="token punctuation">,</span>\n\t\tPermissions<span class="token punctuation">:</span>      <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t<span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">RegisterDIGlobalService</span><span class="token punctuation">(</span>\n    <span class="token operator">...</span>\n    hitrixRegistry<span class="token punctuation">.</span><span class="token function">ServiceProviderCrud</span><span class="token punctuation">(</span>RegisteredExportConfigs<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token operator">...</span>\n<span class="token punctuation">)</span>\n\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>4 - Getting export ready data from crud</strong></p><p>Imagine we have these two cities in our database</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>\n  <span class="token punctuation">{</span>\n    <span class="token property">&quot;ID&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Sofia&quot;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span>\n    <span class="token property">&quot;ID&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;New York&quot;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>We use the crud method to get config/handler and export our data</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>handler<span class="token punctuation">,</span> exists <span class="token operator">:=</span> crudService<span class="token punctuation">.</span><span class="token function">GetExportHandler</span><span class="token punctuation">(</span>CityExportID<span class="token punctuation">)</span> <span class="token comment">// getting the handler</span>\n\nerr<span class="token punctuation">,</span> columns<span class="token punctuation">,</span> data <span class="token operator">:=</span> <span class="token function">handler</span><span class="token punctuation">(</span>\n    ormService<span class="token punctuation">,</span>\n    <span class="token operator">&amp;</span>hitrixCrud<span class="token punctuation">.</span>ListRequest<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// user requesting the export</span>\n    <span class="token boolean">nil</span><span class="token punctuation">,</span> \n<span class="token punctuation">)</span>\n\n<span class="token function">print</span><span class="token punctuation">(</span>columns<span class="token punctuation">)</span>    <span class="token comment">// would print []string{&quot;ID&quot;, &quot;Name&quot;}</span>\n<span class="token function">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// would print [][]interface{}{[]interface{&quot;1&quot;, &quot;Sofia&quot;}, []interface{&quot;2&quot;, &quot;New York&quot;}}</span>\n\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>and you can easily pass this data to our exporter service, for example:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>excelBytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> exporterService<span class="token punctuation">.</span><span class="token function">XLSXExportToByte</span><span class="token punctuation">(</span><span class="token string">&quot;cities&quot;</span><span class="token punctuation">,</span> columns<span class="token punctuation">,</span> data<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>and if you like to check the permissions you can get the whole config like this</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>config<span class="token punctuation">,</span> exists <span class="token operator">:=</span> crudService<span class="token punctuation">.</span><span class="token function">GetExportConfig</span><span class="token punctuation">(</span>CityExportID<span class="token punctuation">)</span> <span class="token comment">// getting the config</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',41),p={},e=(0,a(3744).Z)(p,[["render",function(n,s){return t}]])},3744:(n,s)=>{s.Z=(n,s)=>{for(const[a,t]of s)n[a]=t;return n}}}]);